# ================================
# TEST CONFIGURATION
# ================================
spring.application.name=gateway-test
server.port=0

# Bean override pour éviter les conflits de beans durant les tests
spring.main.allow-bean-definition-overriding=true

# ================================
# EUREKA CLIENT CONFIGURATION - DISABLED FOR TESTS
# ================================
eureka.client.enabled=false
eureka.client.register-with-eureka=false
eureka.client.fetch-registry=false
spring.cloud.discovery.enabled=false

# ================================
# SECURITY CONFIGURATION - SIMPLIFIED FOR TESTS
# ================================
# Désactiver la sécurité OAuth2 pour les tests
spring.security.oauth2.resourceserver.jwt.issuer-uri=
spring.security.oauth2.client.registration.keycloak.client-id=test-client

# Configuration de sécurité simplifiée
spring.security.user.name=test
spring.security.user.password=test
spring.security.user.roles=ACTUATOR

# ================================
# GATEWAY CONFIGURATION - MINIMAL FOR TESTS
# ================================
spring.cloud.gateway.enabled=true
spring.cloud.gateway.discovery.locator.enabled=false

# Routes minimales pour les tests
spring.cloud.gateway.routes[0].id=test-route
spring.cloud.gateway.routes[0].uri=http://localhost:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/test/**

# ================================
# MANAGEMENT ENDPOINTS - SIMPLIFIED
# ================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.security.enabled=false

# ================================
# LOGGING CONFIGURATION - REDUCED FOR TESTS
# ================================
logging.level.org.springframework.cloud.gateway=WARN
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web.reactive=WARN
logging.level.com.netflix.eureka=WARN
logging.level.reactor.netty=WARN
logging.level.root=WARN

# ================================
# TEST SPECIFIC PROPERTIES
# ================================
# Désactiver les configurations qui peuvent causer des problèmes en test
spring.cloud.circuitbreaker.resilience4j.enabled=false
resilience4j.circuitbreaker.instances.default.registerHealthIndicator=false

# Configuration WebFlux pour les tests
spring.webflux.multipart.max-in-memory-size=1MB

# Configuration HTTP client simplifiée
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=PT10S