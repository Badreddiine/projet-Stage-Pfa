# ===================================================================
# Configuration pour Incident Service
# Basée sur le modèle des services qui fonctionnent.
# ===================================================================

# 1. Identification du service
# -------------------------------------------------------------------
spring.application.name=incident-service
server.port=8085


  # 2. Configuration pour l'enregistrement auprès d'Eureka
  # -------------------------------------------------------------------
  # Assure que le service s'identifie de manière unique et correcte.
eureka.client.service-url.defaultZone=http://admin:admin123@discovery-service:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.hostname=incident-service
  # Formule robuste pour un ID unique, évite les conflits.
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.prefer-ip-address=true


  # 3. Configuration de la base de données (DataSource )
  # -------------------------------------------------------------------
  # J'ai supposé les noms pour la base de données et l'utilisateur.
  # Adaptez-les si nécessaire.
spring.datasource.url=jdbc:postgresql://postgres_db:5432/incident_db
spring.datasource.username=incident_user
spring.datasource.password=incident_password

  # Configuration JPA et Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
  # Indique à Hibernate de générer du SQL compatible avec PostgreSQL.
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect


  # 4. Configuration pour la robustesse de la connexion à la base de données
  # -------------------------------------------------------------------
  # Essentiel pour attendre que la base de données soit prête au démarrage.
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.initialization-fail-timeout=0
spring.datasource.hikari.maximum-pool-size=5


  # 5. Configuration des endpoints de management (Actuator)
  # -------------------------------------------------------------------
  # J'ai choisi le port 9004 pour éviter les conflits avec les autres services.
management.server.port=9004
management.endpoints.web.exposure.include=health,info,metrics,prometheus,eureka
management.endpoint.health.show-details=always
