# ===================================================================
# Configuration pour Analysis Service
# ===================================================================

# 1. Identification du service
# -------------------------------------------------------------------
spring.application.name=analysis-service
# Port unique pour ce service, pour éviter les conflits.
server.port=8086


# 2. Configuration pour l'enregistrement auprès d'Eureka
# -------------------------------------------------------------------
# Assure que le service s'identifie de manière unique et correcte.
eureka.client.service-url.defaultZone=http://admin:admin123@discovery-service:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.hostname=analysis-service
# Formule robuste pour un ID unique, évite les conflits.
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.prefer-ip-address=true


# 3. Configuration de la base de données (DataSource )
# -------------------------------------------------------------------
# J'ai supposé les noms pour la base de données et l'utilisateur.
# N'oubliez pas de les créer dans votre script d'initialisation !
spring.datasource.url=jdbc:postgresql://postgres_db:5432/analysis_db
spring.datasource.username=analysis_user
spring.datasource.password=analysis_password

# Configuration JPA et Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
# Indique à Hibernate de générer du SQL compatible avec PostgreSQL.
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect


# 4. Configuration pour la robustesse de la connexion à la base de données
# -------------------------------------------------------------------
# Essentiel pour attendre que la base de données soit prête au démarrage.
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.initialization-fail-timeout=0
spring.datasource.hikari.maximum-pool-size=5

# ================================
# SECURITY CONFIGURATION
# ================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://keycloak:8080/realms/auth-service-realm
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8080/realms/auth-service-realm/protocol/openid_connect/certs


# 5. Configuration des endpoints de management (Actuator)
# -------------------------------------------------------------------
# Port unique pour les endpoints de management.
management.server.port=9006
management.endpoints.web.exposure.include=health,info,metrics,prometheus,eureka
management.endpoint.health.show-details=always
